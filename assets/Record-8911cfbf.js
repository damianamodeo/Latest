import{r as f,f as j,b as S,a as h,j as e,F as b,B as x,C as w,c as A}from"./index-47c006e8.js";import{M as N,d as k,T as M}from"./deleteNotAtHome-29581313.js";import{L as O}from"./Longpress-3d9e85da.js";const E=async({cong:r,mapID:t,suburb:a,street:c,coordinates:o})=>{const n=f(j,r,"maps");try{return await S(j,async u=>{if(!(await u.get(n)).exists())return{};const i=await u.get(n).then(l=>{var g;return(g=l.data())==null?void 0:g.mapDetails});return i[t].suburbs[a].streets.includes(c)||(i[t].suburbs[a].streets=[...i[t].suburbs[a].streets,{name:c,lng:o.lng,lat:o.lat}].sort((l,g)=>l.name.toLowerCase().localeCompare(g.name.toLowerCase()))),u.update(n,{mapDetails:i}),console.log(`<<< NEW STREET ADDED >>>
`,c,`
Latest mapDetails:`,i),i})}catch(s){return console.error(s.message),s}},$=async(r,t,a,c)=>{t==null||t.toString();const o=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r}.json?country=au&bbox=${t==null?void 0:t.join("%2C")}&proximity=151.209889%2C-33.874666&types=address&fuzzyMatch=false&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`;return await fetch(o).then(n=>n.json()).then(n=>n.features)},_=({isOpen:r,closeModal:t,map:a,suburb:c,mapDetails:o})=>{const[n,s]=h.useState({street:"",lng:0,lat:0}),[u,d]=h.useState([]),i=async m=>{if(m.target.value.length<=2){d([]);return}s({street:m.target.value,lng:0,lat:0});const y=await $(n.street,o[a].suburbs[c].bbox,o[a].suburbs[c].name);y&&d(y)},l=()=>{E({cong:"australia_nsw_maitland",mapID:a,suburb:c,street:n.street,coordinates:{lng:n.lng,lat:n.lat}}),t({type:"street",payload:n.street}),s({street:"",lng:0,lat:0}),d([])},g=()=>{t({type:"street",payload:"init"}),s({street:"",lng:0,lat:0})};return e.jsx(N,{isOpen:r,onClose:()=>{},title:"Add Street",height:"lg",children:e.jsx("div",{className:"h-full relative",children:e.jsx(b,{children:e.jsxs("div",{className:"flex justify-evenly m-4",children:[e.jsx(b.Autocomplete,{value:n.street,onChange:m=>{i(m)},onSelect:m=>{console.log(m.props.children[0].props.id),s({street:m.props.children[0].props.children,lng:m.props.children[0].props.id[0],lat:m.props.children[0].props.id[1]})},options:u.map((m,y)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",id:m.center,children:m.text}),e.jsx("div",{className:"text-xs",children:m.place_name.split(", ")[1]})]})),width:"lg"}),e.jsxs("div",{className:"flex gap-2 m-auto absolute bottom-0 justify-evenly w-full",children:[e.jsx(x,{color:"blue",clickAction:g,width:"sm",children:"Cancel"}),u.map(m=>m.text).includes(n.street)&&e.jsx(x,{color:"blue",clickAction:l,width:"sm",children:"Add"})]})]})})})})},L=async({cong:r,mapID:t,suburb:a,bbox:c})=>{const o=f(j,r,"maps");try{const n=await S(j,async s=>{if(!(await s.get(o)).exists())return console.log("<<<NO SUCH DOCUMENT>>>"),{};const d=await s.get(o).then(i=>{var l;return(l=i.data())==null?void 0:l.mapDetails});return d[t].suburbs=[...d[t].suburbs,d[t].suburbs.map(({name:i})=>(console.log(i),i)).includes(a)?null:{streets:[],bbox:c,name:a}].sort((i,l)=>i.name.toLowerCase().localeCompare(l.name.toLowerCase())),s.update(o,{mapDetails:d}),d});return console.log(`<<< NEW SUBURB ADDED >>>
`,a,`
Latest mapDetails:`,n),n}catch(n){return console.error(n.message),n}},W=async(r,t,a)=>await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${r}.json?types=place&proximity=151.209889,-33.874666&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`).then(o=>o.json()).then(o=>o.features),z=({isOpen:r,closeModal:t,map:a})=>{const[c,o]=h.useState(""),[n,s]=h.useState([]),[u,d]=h.useState([]),[i,l]=h.useState([]),g=async p=>{if(o(p.target.value),p.target.value.length<=2){d([]);return}const I=await W(p.target.value);l(I.map((v,D)=>({display:e.jsxs("div",{className:`${D} font-semibold`,children:[v.text,e.jsx("div",{className:"text-sm font-light dark:text-neutral-200",children:v.place_name})]}),...v})))},m=p=>{s(i[p.props.className[0]].bbox),o(p.props.children[0])},y=()=>{L({cong:"australia_nsw_maitland",mapID:a,suburb:c,bbox:n}),t({type:"suburb",payload:c}),o(""),d([])},C=()=>{t({type:"suburb",payload:"init"}),o("")};return h.useEffect(()=>(d(i.map(p=>p.display)),()=>{}),[i]),e.jsx(N,{isOpen:r,onClose:()=>{},title:"Add Suburb",height:"lg",children:e.jsx("div",{className:"h-full relative",children:e.jsx(b,{children:e.jsxs("div",{className:"flex justify-around m-4",children:[e.jsx(b.Autocomplete,{value:c,onChange:p=>g(p),onSelect:m,options:u,width:"lg"}),e.jsxs("div",{className:"flex gap-2 m-auto-xx absolute bottom-0 justify-evenly w-fit",children:[e.jsx(x,{color:"blue",clickAction:C,width:"sm",children:"Cancel"}),u.map(p=>p.props.children[0]).includes(c)&&e.jsx(x,{color:"blue",clickAction:y,width:"sm",children:"Add"})]})]})})})})},Q=async({houseNumber:r,street:t,suburb:a,bbox:c,country:o})=>{const s=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r}%20${t}%20${a}%20.json?country=au&bbox=${c[0]-.015}%2C${c[1]-.015}%2C${c[2]+.015}%2C${c[3]+.015}&types=address&fuzzyMatch=false&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`;return await fetch(s).then(u=>u.json()).then(u=>({lng:u.features[0].center[0],lat:u.features[0].center[1],relevance:u.features[0].relevance}))},R=async({cong:r,mapID:t,lng:a,lat:c,relevance:o,streetCoordinates:n,...s})=>{const u={["id"+Date.now()]:{user:`${localStorage.getItem("initID")}_${localStorage.getItem("username")}`,id:Date.now(),mapNumber:t,relevance:o,...s,...o>.7037?{lng:a,lat:c}:n}},d=f(j,"notAtHomes","MaitlandCongregation");try{const i=await S(j,async l=>{const g="id"+Date.now();return(await l.get(d)).exists()?(l.update(d,u),u):(l.set(d,u),"First Not At Home created successfully")});return console.log(`<<< NEW NOT AT HOME ADDED >>>
Address Details:`,i),i}catch(i){return console.error(i.message),i}},Z=({closeModal:r,address:t,streetCoordinates:a,bbox:c,dispatch:o})=>{const[n,s]=h.useState({lng:0,lat:0,relevance:0}),u=async()=>{const i=await Q({...t,bbox:c});s(i)},d=async i=>{await R({...n,...t,calls:[Date.now()],cong:"australia_nsw_maitland",streetCoordinates:a,letter:i}),t.unitNumber===""&&o({type:"houseNumber",payload:""}),o({type:"unitNumber",payload:""}),r(!1)};return h.useEffect(()=>{u()},[]),e.jsx(N,{isOpen:!0,onClose:()=>{},title:"Confirm Address",height:"lg",children:e.jsx(w,{children:e.jsx("div",{className:"h-full relative text-white",children:e.jsxs(b,{children:[e.jsx("div",{className:"text-center m-4",children:n.relevance===1?e.jsx("span",{className:"text-green-500",children:"Exact match was found."}):e.jsx("span",{className:"text-orange-500",children:"WARNING! An exact match was not found. Please check details before submitting this address."})}),e.jsxs("div",{className:"text-center m-4",children:[t.unitNumber,t.unitNumber?"/":"",t.houseNumber," ",t.street,", ",t.suburb," "]}),e.jsxs(w,{style:"gap-5 mt-4",children:[e.jsx(x,{color:"blue",width:"md",clickAction:()=>r(!1),children:"cancel"}),e.jsx(x,{color:"blue",width:"md",clickAction:()=>d(!0),children:"Letter List"}),e.jsx(x,{color:"blue",width:"md",clickAction:()=>d(!1),children:"Return List"})]})]})})})})},F=(r,t)=>typeof t.payload=="object"?{...r,[t.type]:"adding "+t.type}:{mapID:{mapID:t.payload,suburb:"init",street:"init",houseNumber:"",unitNumber:""},suburb:{...r,suburb:t.payload,street:"init",houseNumber:"",unitNumber:""},street:{...r,street:t.payload,houseNumber:"",unitNumber:""},houseNumber:{...r,houseNumber:t.payload},unitNumber:{...r,unitNumber:t.payload}}[t.type],G=({mapDetails:r})=>{const[t,a]=h.useReducer(F,{mapID:"init",suburb:"init",street:"init",houseNumber:"",unitNumber:"",mapData:{}}),[c,o]=h.useState(!1),n=()=>Math.max(0,r.findIndex(l=>l.id==t.mapID)),s=()=>t.mapID==="init"?0:Math.max(0,r[n()].suburbs.findIndex(l=>l.name===t.suburb)),u=()=>r[n()].suburbs[s()].streets.findIndex(l=>l.name===t.street),d=r.length===0?[]:r[n()].suburbs.map(l=>l.name),i=r.length===0?[]:r[n()].suburbs.length===0?[]:r[n()].suburbs[s()].streets.map(l=>l.name);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center p-2",children:[e.jsxs(b,{children:[e.jsx(b.Select,{onChange:l=>{a({type:"mapID",payload:l})},options:r.map(l=>l.id),placeholder:"Map",value:t.mapID,width:"lg",height:"xl"}),e.jsx("div",{className:"h-2"}),t.mapID!=="init"&&e.jsx(b.Select,{onChange:l=>{a({type:"suburb",payload:l})},value:t.suburb,options:[...d,e.jsx("span",{className:"text-blue-400",children:"add new suburb"})],placeholder:"Suburb",width:"lg",height:"xl"}),e.jsx("div",{className:"h-2"}),t.suburb==="init"?null:e.jsx(b.Select,{onChange:l=>{a({type:"street",payload:l})},value:t.street,options:[...i,e.jsx("span",{className:"text-blue-400",children:"add new street"})],placeholder:"Street",width:"lg",height:"xl"}),e.jsx("div",{className:"h-2"}),e.jsxs("div",{className:"flex",children:[t.street==="init"?null:e.jsx(b.Alphanumeric,{value:t.houseNumber,label:"",placeholder:"House",onChange:l=>a({type:"houseNumber",payload:l}),width:"sm",height:"xl"}),e.jsx("div",{className:"grow"}),t.houseNumber===""?null:e.jsx(b.Alphanumeric,{value:t.unitNumber,label:"",placeholder:"Unit",onChange:l=>a({type:"unitNumber",payload:l}),width:"xs",height:"xl"})]}),e.jsx("div",{className:"h-8"}),e.jsx("div",{className:"grid gap-4",children:t.houseNumber===""?null:e.jsx(x,{clickAction:()=>o(!0),width:"full",color:"blue",children:"Add"})})]}),e.jsx(z,{isOpen:t.suburb==="adding suburb",closeModal:a,map:n()}),e.jsx(_,{isOpen:t.street==="adding street",closeModal:a,map:n(),suburb:s(),mapDetails:r}),c&&e.jsx(Z,{closeModal:o,address:t,bbox:r[n()].suburbs[s()].bbox,streetCoordinates:{lng:r[n()].suburbs[s()].streets[u()].lng,lat:r[n()].suburbs[s()].streets[u()].lat},dispatch:a})]})})},H=({isOpen:r,address:t,setUpdateModelOpen:a})=>e.jsxs(N,{onClose:()=>{},title:"",isOpen:r,height:"md",children:[e.jsxs("div",{className:"h-full text-center text-lg dark:text-white",children:["Would you like to delete",e.jsxs("p",{className:"font-bold text-xl py-2",children:[t.unitNumber&&`${t.unitNumber}/`,t.houseNumber," ",t.street,", ",t.suburb,"?"]})]}),e.jsx(w,{children:e.jsxs("div",{className:"grid gap-8",children:[e.jsx(x,{width:"md",clickAction:()=>{a(!1)},color:"red",children:"NO"}),e.jsx(x,{width:"md",clickAction:()=>{k(t),a(!1)},color:"green",children:"YES"})]})})]}),X=({notAtHomesList:r})=>{const[t,a]=h.useState(!1),[c,o]=h.useState({}),n=s=>{o(s),a(!0)};return e.jsxs("div",{className:"pb-16",children:[e.jsx("div",{className:"text-sm text-center m-2 text-blue-500 dark:text-blue-300",children:"Press and hold to delete"}),r&&r.sort((s,u)=>u.key.localeCompare(s.key)).filter(s=>s.user===`${localStorage.getItem("initID")}_${localStorage.getItem("username")}`).map((s,u)=>e.jsx("div",{children:e.jsx(O,{action:()=>n(s),children:e.jsxs("div",{className:`grid grid-cols-12 h-12 border-b dark:border-darkGrey-700 text-sm text-center ${s.letter?"text-neutral-500 dark:text-neutral-400":"X"}`,children:[e.jsx("div",{className:"col-span-2 px-2 my-auto font-bold",children:s.mapNumber}),e.jsx("div",{className:"col-span-1 px-2 my-auto",children:`${s.unitNumber&&`${s.unitNumber}/`}${s.houseNumber}`}),e.jsx("div",{className:"col-span-4 my-auto",children:`${s.street}`}),e.jsx("div",{className:"col-span-4 my-auto",children:s.suburb})]})})},u)),t&&e.jsx(H,{isOpen:t,address:c,setUpdateModelOpen:a})]})},T=()=>{const[r,t]=h.useState([]),[a,c]=h.useState([{key:""}]);return h.useEffect(()=>A(f(j,"notAtHomes","MaitlandCongregation"),n=>{const s=n.data(),u=s?Object.keys(s).map(d=>({key:d,...s[d]})):[];c(u)}),[]),h.useEffect(()=>{const o=A(f(j,"australia_nsw_maitland","maps"),n=>{var s;n.data()&&t((s=n.data())==null?void 0:s.mapDetails)});return()=>{o()}},[]),e.jsx("div",{className:"h-full",children:e.jsx(M,{color:"blue",tabItems:[{title:"Add",content:e.jsx(G,{mapDetails:r})},{title:"List",content:e.jsx(X,{notAtHomesList:a})}]})})};export{T as default};
